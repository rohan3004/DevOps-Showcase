# This is the main configuration file for Nginx

# Default worker processes (can be adjusted)
worker_processes 1;

events {
    worker_connections 1024;  # Number of connections per worker
}

http {
    include       /etc/nginx/mime.types;  # File types that Nginx can handle
    default_type  application/octet-stream;  # Default MIME type
    access_log    /var/log/nginx/access.log;
    error_log     /var/log/nginx/error.log;

    sendfile on;  # Enable sendfile for static file serving
    tcp_nopush on;
    tcp_nodelay on;
    keepalive_timeout 65;  # Timeout for keep-alive connections

    # Compress responses
    gzip on;
    gzip_min_length 1000;
    gzip_types text/plain text/css application/json application/javascript text/xml application/xml application/xml+rss text/javascript;

    # Server Block
    server {
        listen 80;  # Nginx listens on port 80 (HTTP)

        # Accept any server name (use wildcard '_')
        server_name _;

        # Root directory (can be adjusted if you serve static content)
        # root /usr/share/nginx/html;

        # Logging configuration
        access_log /var/log/nginx/access.log;
        error_log /var/log/nginx/error.log;

        # Reverse Proxy Setup
        location / {
            proxy_pass http://speakx-demo-app:8080;  # Forward requests to Spring Boot app (app container)
            proxy_set_header Host $host;  # Preserve the Host header
            proxy_set_header X-Real-IP $remote_addr;  # Set the clientâ€™s real IP
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;  # Add the original IP to X-Forwarded-For header
            proxy_set_header X-Forwarded-Proto $scheme;  # Pass the protocol (http or https)
            proxy_set_header X-Forwarded-Port $server_port;  # Pass the server port
            proxy_http_version 1.1;
            proxy_set_header Upgrade $http_upgrade;  # Set the Upgrade header for WebSocket support
            proxy_set_header Connection 'upgrade';  # Set the Connection header for WebSocket support
        }

        # Additional location blocks can be added as needed (e.g., static files, error pages)
    }
}
